<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>linuxcram.github.io - 14_loops</title>
<style>
header {
  width: 100%;
}
body {
  background: #333333;
  color: #f2f2f2;
  font-size: 14px;
  font-family: monospace;
  text-align: left;
  line-height: 1.3;
  margin: 0;
  border: 20px solid transparent;
}
a:link {
  color: #ff6000;
  background-color: transparent;
  text-decoration: none;
}
a:visited {
  color: #00bbbb;
  background-color: transparent;
  text-decoration: none;
}
a:active {
  color: #00bb00;
  background-color: transparent;
}
hr {
  height: 3px;
  background-color: #00ee00;
  border: none;
}
</style>
</head>
<body>
<div style="text-align: center;">
<img src="https://raw.githubusercontent.com/linuxcram/linuxcram.github.io/main/logo_hackersgen.png" alt="logo_hackersgen" width="348" height="50">
<br>
<img src="https://raw.githubusercontent.com/linuxcram/linuxcram.github.io/main/tux01.png" alt="Tux" width="45" height="45">
<h2>
linuxcram.github.io
</h2>
<img src="https://raw.githubusercontent.com/linuxcram/linuxcram.github.io/main/logo_sorint.png" alt="logo_sorint" width="102" height="30">
&nbsp;&nbsp;&nbsp;
<img src="https://raw.githubusercontent.com/linuxcram/linuxcram.github.io/main/logo_sorint1.png" alt="logo_sorint1" width="30" height="30">
</div>
<h3><a href="https://linuxcram.github.io/">HOME</a></h3>
<div style="text-align: center;">
<p>
<a href="https://linuxcram.github.io/13_samplecode.html">[13_samplecode]</a>
 &lt; &gt; 
<a href="https://linuxcram.github.io/15_scripts.html">[15_scripts]</a>
</p>
</div>
<hr>
<h3>[14_loops]
<br>
<br>
Common loops in programming languages</h3>
The loop constructs are common programming building blocks that allow us to repeat the execution of a section of code through an iteration.
<br>
<br>
The three main types of iteration constructs in bash are the count-controlled loops (or definite iteration), the condition-controlled loops (or indefinite iteration), the infinite loops.
<br>
<br>
The count-controlled loop repeats the execution of a section of code for a certain number of times. The counting can be upward or downward with varying step size. This loop generally uses a for loop construct.
<br>
<br>
The condition-controlled loop repeats the execution of a section of code until a condition is met. The condition may be tested at the beginning, or the end of the loop. This loop generally uses a while loop construct.
<br>
<br>
The infinite loop repeats the execution of a section of code forever or until an exception arises. This loop often uses a while true loop construct and is sometimes called an endless loop or a forever loop.
<br>
<br>
<br>
<h3>BASH LOOPS</h3>
<br>
<i>The example loops are shown as one-liners so the ; separator is required.
<br>
When the loops are written inside scripts, the separator is not needed since every line is interpreted separately.
</i>
<br>
<br>
<br>
<h4>For Loop</h4>
Hint: think about the cycles to easily memorize their sintax KEYWORDS in an understandable sentence.
<br>
The construct string "for VALUE in RANGE ; do OPERATION ; done" may be remembered as:
<br>
"for (every value assigned to) VARIABLE in RANGE (that is the range of values) ; do (perform the) OPERATION ; done (cycle complete)"
<br>
<br>
For repetitive cycle that prints numbers from 1 to 3:
<br>
<br>
for i in {1..3}; do echo $i; done
<br>
<br>
# the RANGE can be defined with specific values
<br>
for i in 1 2 3; do echo $i; done
<br>
<br>
for i in {1 2 3}; do echo $i; done
<br>
<br>
i is an arbitrary name of the variable which will be assigned the values defined in the specified range
{1..3} or 1 2 3 represents the range of value that will be assigned to i by the "for" cycle, the echo command will use the value assigned to i as argument for each cycle of the for loop
<br>
<br>
<br>
<b>Count-controlled For Loop (counter)</b>
<br>
for ((x=0 ; x&lt;5 ; x++)); do echo $x; done
<br>
<br>
x is an arbitrary name of the variable (it can be named as any variable) that the for cycle will use to assign the values in the range,
<br>
the range is represented numerically starting from 0, using the incremental function x++ that will increase its value by 1 unit till the condition x&lt;5 is true.
<br>
<br>
The function x++ and --x can be used to print the first value as well without the need of echo $x before increment/decrement.
<br>
<br>
x&lt;5 represents the valid condition that keeps the cycle running, for every cycle where this condition is true
<br>
the incremental function will be applied and echo will get the value of x as argument,
<br>
when the condition x&lt;5 is no more true, the cycle is terminated.
<br>
<br>
<br>
<h4>While Loop</h4>
Hint: the construct string "VARIABLE=VALUE ; while CONDITION ; do OPERATION ; done" may be remembered as:
<br>
"(the) VARIABLE (is equal to) = VALUE ; while (the) CONDITION (is true) ; do (perform the) OPERATION ; done (cycle complete)"
<br>
<br>
While (non specific values defined) cycle that prints numbers from 1 to 5:
<br>
<br>
x=1; while (( x &lt;= 5 )); do echo $((x++)); done
<br>
<br>
x is the arbitrary name of the variable
<br>
the incremental funtion will be applied till the condition is true,
<br>
that means that x is incremented by 1 unit while its value satisfy the condition x &lt;= 5
<br>
and its value is printed on screen by echo in every cycle
<br>
but the first time that the condition results false, with x=6, the cycle is terminated.
<br>
<br>
The same result is obtained using a different sintax
<br>
<br>
x=1; while (( x &lt; 5 )); do echo $(( x++ )); done
<br>
<br>
x=1; while (( x &lt; 5 )); do echo $x; (( x++ )); done
<br>
<br>
The concept behind the WHILE cycle may also be imagined as a self-driving car that moves on a road:
<br>
WHILE there is road the car moves, when there is no more road the car stops.
<br>
<br>
<br>
<h4>Until Loop</h4>
Hint: the construct string "VARIABLE=VALUE; until CONDITION; do OPERATION; done" may be remembered as:
<br>
"(the) VARIABLE (is equal to) = VALUE; until (the) CONDITION (is true); do (perform the) OPERATION; done (cycle complete)"
<br>
<br>
x=3; until (( x &lt;= 0 )); do echo $((x--)); done
<br>
<br>
x is the arbitrary name of the variable that will have an initial value of 3,
<br>
at every cycle x is decremented of 1 unit, for every value that make the condition x&lt;=0 false, 
<br>
the echo command receives the value of x as argument in every cycle,
<br>
but when x reaches the value of -1 the condition become true, and the cycle is terminated.
<br>
<br>
Same result with different sintax
<br>
<br>
x=3; until (( x &lt;= 0 )); do echo $(( --x )); done
<br>
<br>
x=3; until (( x &lt;= 0 )); do echo $x; (( --x )); done
<br>
<br>
The concept behind the UNTIL cycle may also be imagined as ...a self-driving car that moves on a road:
<br>
UNTIL the road ends, the car moves.
<br>
The car moves on the road, when the road ends the car stops.
<br>
<br>
<br>
<b>Warning
<br>
Bad scripts may contain endless loops resulting in infinite operations!</b>
<br>
Hopefully they could be terminated with keyboard combination <i>CTRL+c
<br>
CTRL+C sends the INT ("interrupt") signal to the foreground process of the shell.</i>
<br>
<br>
Endless loops examples - commented out because not meant to be never used!
<br>
<br>
# for (( ; ; )); do echo "infinite loop"; done
<br>
<br>
# while : ; do echo "infinite loop"; done
<br>
<br>
# while true : ; do echo "infinite loop"; done
<br>
<br>
# until false; do echo "infinite loop"; done
<br>
<br>
<br>
<h3>Conditional Statements</h3>
<br>
<h4>If</h4>
Hint: the construct string "if CONDITION ; then OPERATION; elif CONDITION ; then OPERATION ; else OPERATION; fi" may be remembered as:
<br>
"if (the) CONDITION (is true); the (perform the) OPERATION; elif (else if) CONDITION (is true); then (perform the) OPERATION ; else (in any other case perform the) OPERATION; fi (cycle complete)"
<br>
<br>
The <b>minimal</b> if cycle is "if CONDITION ; then OPERATION; else OPERATION; fi" that may be remembered as:
<br>
"if (the) CONDITION (is true); the (perform the) OPERATION; else (otherwise perform the) OPERATION; fi (cycle complete)"
<br>
<br>
The keyword that indicates the end of the cycle is fi that represents the reversed word if.
<br>
<br>
<br>
The if statement is a conditional expression, that evaluates the result of the command based on the exit status.
<br>
<br>
If the command completes successfully, the condition is true and the exit status is 0.
<br>
<br>
If the statement produces an error, the condition is false and the exit status is any number between 1 and 255.
<br>
<br>
<b>If syntax</b>
<pre>
The single bracket represent a test command following the standard POSIX utility available for all shells.
if [ CONDITION ]
then
  COMMANDS
fi

The double-bracket syntax in bash scripts is the best option if portability is not necessary,
double-brackets are superior to single-brackets and include advanced options.
if [[ CONDITION ]]
then
  COMMANDS
fi

The if else statement includes the definition of different actions based on the output of the condition. 
if [ CONDITION ]
then
  COMMANDS
else
  COMMANDS
fi

The elif clause combined with the if else statement performs multiple conditional checks with different results.
if [ CONDITION ]
then
  COMMANDS
elif [ CONDITION ]
then
  COMMANDS
else
  COMMANDS
fi
</pre>
<br>
Nested if statements perform a first if check of a condition that if satisfied passes to a the next check.
<pre>
if [ CONDITION ]
then
    if [ CONDITION ]
    then
        COMMANDS
    fi
fi
</pre>
<br>
<h4>Case</h4>
The bash case statement can simplify complex conditionals when we have multiple different choices.
<br>
The case statement can be used to replace nested if statements to produce bash scripts more readable and easier to maintain.
<br>
<br>
Syntax:
<pre>
case EXPRESSION in
  PATTERN1)
    statement
    ;;
  PATTERN2)
    statement
    ;;
  PATTERN3)
    statement
    ;;
  *)
    statement
    ;;
esac
</pre>
<h4><i>Case example</i></h4>
script checkday.sh
<br>
<pre>
#!/bin/bash
# define current weekday
day=$(date +"%a")
# case statement to check if today is a weekday or a weekend day and print the corresponding result
case $day in 
  Mon | Tue | Wed | Thu | Fri)
    echo "Today is a weekday";;
  Sat | Sun) 
    echo "Today is weekend";;
  *)
    echo "Error: current day is not defined";;
esac

# set executable permissions for the current user
chmod u+x checkday.sh

# run the script, note that when a script is run it is required the prefix ./ to declare its location,
# if the script is not located in "bin" directories that the system uses for binaries
# (such as /usr/local/bin , /usr/bin , etc)
./checkday.sh 

# the output of the script, run on a weekday, is:
Today is a weekday
</pre>
<br>
<h4>About if conditions and operators</h4>
The following conditions will return a true value if the corresponding element type exists:
<pre>
-f    common regular file
-d    directory
-e    any type of file
-r    readable file
-w    writable file
-x    executable file
-s    file exists and its size is not zero
-L    symbolic link
</pre>
Often the best practice is to define the first condition that, if false, would cause failure of next tasks.
<br>
<br>
If the unmet condition compromises the main task, the script often may exit with a custom exit code and a messsage.
The usage of exit codes add efficiency to scripts (0 for "no errors" , other custom values for "errors").
<br>
<br>
This way, if a required condition for the script is not met, less commands will be executed, saving time and resources.
<br>
<br>
The ! negation is useful to check if a condition is unmet.
<br>
<br>
Examples
<pre>
# if element met the condition, execute the operation
if [ -e test.txt ]
then
  cat test.txt
fi

# if element met multiple conditions (double brackets required by bash), execute the operation
if [[ -e test.txt &amp;&amp; -r test.txt &amp;&amp; -s test.txt ]]
then
  cat test.txt
fi

# if element met at least one of the conditions, execute the operation
if [[ -e test.txt || -e testfile_20.txt || -e test_abc.txt ]]
then
  ls -lh test*
fi

# if element does not met the condition, exit, otherwise (condition met) execute the operation
if ! [ -e test.txt ]
then
  echo "Error: missing file"
  exit 11
else
  cat test.txt
  exit 0
fi

# if element does not met the condition, exit, otherwise (condition met) execute the operation
if ! [ 1 -lt 2 ]
then
  echo "Error: 1 is not &lt; 2"
  exit 11
else
  echo "OK 1 is &lt; 2"
  exit 0
fi
</pre>
<hr>
<div style="text-align: center;">
<p>
<a href="https://linuxcram.github.io/13_samplecode.html">[13_samplecode]</a>
 &lt; &gt; 
<a href="https://linuxcram.github.io/15_scripts.html">[15_scripts]</a>
</p>
</div>
<h3><a href="https://linuxcram.github.io/">HOME</a></h3>
<div style="text-align: center;">
<p>
<img src="https://raw.githubusercontent.com/linuxcram/linuxcram.github.io/main/logo_sorint.png" alt="logo_sorint" width="102" height="30">
&nbsp;&nbsp;&nbsp;
<img src="https://raw.githubusercontent.com/linuxcram/linuxcram.github.io/main/logo_sorint1.png" alt="logo_sorint1" width="30" height="30">
</p>
</div>
</body>
</html>
